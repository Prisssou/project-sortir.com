{% extends 'layout.html.twig' %}

{% block title %}Sortir.com{% endblock %}
{% block stylesheet %}
    <link rel="stylesheet" href="{{ asset('css/style-table.css') }}">

{% endblock %}
{% block body %}

    {% for message in app.flashes('success') %}
        <div class=" container flash-notice">
            {{ message }}
        </div>
    {% endfor %}

    <div>
        <h1>Bienvenue sur Sortir.com !</h1>
        <h2 class="d-none d-md-block"> Envie <span class="typing"></span></h2>
        <script
                src="https://code.jquery.com/jquery-3.4.1.min.js"
                integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
                crossorigin="anonymous"></script>
        <script src="js/typed.min.js"></script>
        <script src="js/animation.js"></script>

        <h2> Rejoignez le réseau de l'ENI !</h2>

        <h3> Qu'avez-vous manqué aujourd'hui ? </h3><br>
    </div>

    <div class="container">

        <div class="row">
            {#

                        {% for article in articles %}
                            <div class="col-lg-3" id="box-shadow">
                                <ul style="list-style-image: url({{ asset('img/hang.png') }})">
                                    {% if app.user %}
                                    <a href="{{ path('detail', {'id':article.id}) }}">
                                        {% endif %}
                                        <img id="article-image" src="{{ asset('uploads/images') }}/{{ article.image }}  "
                                             alt="article"></a>
                                    <li> Nom : {{ article.nom }}</li>
                                    <li> Description : {{ article.description }}</li>
                                    <li> Echangé par : {{ article.user.getUsername() }}</li>
                                </ul>
                            </div>
                        {% else %}
                            Il n'y a pas d'articles à échanger.
                        {% endfor %}#}


        </div>
    </div>

    <section id="section-filtre">


        {% include 'includes/homeFilter.html.twig' with {form: form} only %}


    </section>

    <section id="section-tableau-sorties">

        <div class="tab">
            {% for site in sites %}

                {% if app.user.site == site.name %}

                    <button class="tablinks active"
                            onclick="openCity(event, '{{ site.name }}')">{{ site.name }}</button>
                {% else %}
                    <button class="tablinks" onclick="openCity(event, '{{ site.name }}')">{{ site.name }}</button>

                {% endif %}
            {% endfor %}
        </div>


        {% for site in sites %}

            <!-- Tab content -->

            {% if app.user.site == site.name %}

                <div id="{{ site.name }}" class="tabcontent" style="display: block">
            {% else %}
                <div id="{{ site.name }}" class="tabcontent">
            {% endif %}
            <h3>{{ site.name }}</h3>

            {# Tableau des sorties #}
            <table style="width:100%">
                <tr>
                    <th>Nom de la sortie</th>
                    <th>Date de la sortie</th>
                    <th>Clôture</th>
                    <th>Inscrits/Places</th>
                    <th>Etat</th>
                    <th>Déjà inscrit?</th>
                    <th>Organisateur</th>
                    <th>Actions</th>
                </tr>

                {% for sortie in sorties %}

                    {% if site.name == sortie.site %}

                        <tr>
                            <td>{{ sortie.name }}</td>
                            <td>{{ sortie.startDate|date('d/m/Y à H:i') }}</td>
                            <td>{{ sortie.closingDate|date('d/m/Y') }}</td>
                            {% if sortie.numberSub == sortie.numberMaxSub %}
                                <td>
                                    <span style="color: red; font-weight: bold">{{ sortie.numberSub }}</span>/{{ sortie.numberMaxSub }}
                                </td>
                            {% else %}
                                <td>
                                    <span style="color: green; font-weight: bold">{{ sortie.numberSub }}</span>/{{ sortie.numberMaxSub }}
                                </td>

                            {% endif %}
                            <td>{{ sortie.state.label }}</td>

                            {# Indique si l'utilisateur est inscrit à la sortie #}

                            {% for sub in subscriptions %}
                            {% if sub.member.id == app.user.id %}
{#                                {% if sortie.subscriptions == sub.id %}#}
                                <td> Oui</td>
                            {% else %}
                                <td></td>
{#                                    {% endif %}#}
                            {% endif %}
                            {% endfor %}

{#                            <td> Oui</td>#}

                            {#                    <td>{{dump(sortie.member)}}</td>#}
                            {% for member in sortie.member %}
                                <td> {{ member.username }}</td>
                            {% endfor %}

                            <td>
                                <a href="{{ path('detail', {id: sortie.id}) }}">Afficher</a>
                                <a href="{{ path('subscribe', {id: sortie.id}) }}">S'inscrire</a>
                            </td>

                        </tr>
                    {% endif %}

                {% endfor %}

            </table>
            </div>
            </div>

        {% endfor %}


    </section>

    <section>

        <button class="btn btn-primary"><a href="{{ path('add_outing') }}" style="color: white; text-decoration: none">Créer une nouvelle sortie</a></button>


    </section>

    <footer>
        <div></div>
        Icons made by <a href="https://www.flaticon.com/authors/freepik" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon"> www.flaticon.com</a>


    </footer>
    <script src="{{ asset('js/table-animation.js') }}"></script>
{% endblock %}
